#!/usr/bin/python
#coding:utf-8

import gmpy2
from Crypto.PublicKey import RSA
import ContinuedFractions, Arithmetic
from Crypto.Util.number import long_to_bytes 

def wiener_hack(e, n):
    # firstly git clone https://github.com/pablocelayes/rsa-wiener-attack.git !
    frac = ContinuedFractions.rational_to_contfrac(e, n)
    convergents = ContinuedFractions.convergents_from_contfrac(frac)
    for (k, d) in convergents:
        if k != 0 and (e * d - 1) % k == 0:
            phi = (e * d - 1) // k
            s = n - phi + 1
            discr = s * s - 4 * n
            if (discr >= 0):
                t = Arithmetic.is_perfect_square(discr)
                if t != -1 and (s + t) % 2 == 0:
                    print("Hacked!")
                    return d
    return False
def main():
    n = 1606461905396537704240877351915565237013657816060078479686401848795914997017893182969543555327012599375185853030055617193695470959514306231464860899742893376809547247853539954627902302123439286955582193619088244762445761773521086732485031690944878930103425589327252876068661045328399475577224811494486065370354677721814393231169608904174753637287339475887620772549324925052192942057466861593346711947268757541392653645286719614812322140788229360932690697513322209934602251055555606850825055298988726282856457008861729285091442372568622938272657386109749253502375776564687252035722918683051434126736803212417898523534388176800941465191787252257236597785048941709457736017470593837334808555244970357801193203420801923456329430924848838653047565867864787259647338964266821704026140906392573779299205631616922912035686141186592092555255087822424368970334093470756276801705385034554747866737105425505539804408353364229230032578981
    e = 65537
    c = 427758254382415837486627169903586043192159296039318441074461933745092029340448694096175109946245753195246814262819567533262451810052332405450716560571849213140885180173856551587913073299532107644491799556003896399818866305175352349346751314722576415776346304969996320863217041678143403067644016009615411010737559370133156446410055020685186435335470313884574914865891412617452265910734243504789980182558624400822862796541339623567917969899600164401464008985669419391933303540699639959809908793374182929155739823243017220533117710038049157763010512581281031119184742089044402194034365598637195703708047088123630678175359960520486949206285944574233192009388419398104082222605620849891876659072833092191551654472365200824659341839571984128702022835047590060023539856161799809238580562851150509794219414923021381190448036042219044339644762734802649041090859430137188161941607186005419294808381757372611413573897418193511161733357

    d = wiener_hack(e, n)
    m = pow(c,d,n)
    print(m)
    print(long_to_bytes(m))
if __name__=="__main__":
    main()
