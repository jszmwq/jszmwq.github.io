#!/usr/bin/python
#coding:utf-8

import gmpy2
from Crypto.PublicKey import RSA
import ContinuedFractions, Arithmetic
from Crypto.Util.number import long_to_bytes 

def wiener_hack(e, n):
    # firstly git clone https://github.com/pablocelayes/rsa-wiener-attack.git !
    frac = ContinuedFractions.rational_to_contfrac(e, n)
    convergents = ContinuedFractions.convergents_from_contfrac(frac)
    for (k, d) in convergents:
        if k != 0 and (e * d - 1) % k == 0:
            phi = (e * d - 1) // k
            s = n - phi + 1
            discr = s * s - 4 * n
            if (discr >= 0):
                t = Arithmetic.is_perfect_square(discr)
                if t != -1 and (s + t) % 2 == 0:
                    print("Hacked!")
                    return d
    return False
def main():
    n = '26242380067186457149272420614780267205990154849572446971798414008533348917917471795620597536716260203158747849304913215124934247250772714065678742864810946142065642805682001810007798267119478665034962919811437031941796881975718591217615962183120375273990165099068592386177395399948765428071896177033858579451217243614601434392032818316781978946793337363263840744624323236584052876982810939404877777442563829167392426829572404083682821172150417803044658081521438867363472497382376464058005909035594803838338936982460265521823142562392718581919504833187646880871839551294740590555115616550034826855846297996431324584463'
    e = '11734566734023613485945119166743349266748857469922472773372588276659972618422110484564487539769105870133725205973903632078868786950735047900667260360635639369379265250275300752283183604666793078504977681297110621156106821839031880209226105179038673971959448011211600250098728318381286232720158948925736953094751479757907948732333088075374215955877126375672407309246942648237449129118508529152313496905330897676023090648092072486928932483824731843460632904050867994500792734629578698907979141674901223716175851857426891431068874303540035711387949915459434162769553607082639685827138151858319403046101994019000251296493'
    c = 9230500154261025935468131726535770033301507523871308263359354453226810064676483741833498468988522888628705689879881487374759959160570514691353758117852557052363084334253012622330127739804827917476417198037080767726240249702267498320219196036316822112191672971181087640835974306282063814300927801950412760375620354949744436987276981439645439534428900821378693137671813977554827454773967112596400883834012684831319977058346228831871134249489611844397637960759530046640881670880244210635023034283108521535193595040526420684269723737329678814055058464565055048196650899210160496927513059944920532588699408002508933127459
    d = wiener_hack(e, n)
    m = pow(c,d,n)
    print(long_to_bytes(m))
if __name__=="__main__":
    main()
